# Readme

## 简介

本项目使用openGL渲染了一个放烟花的场景，具体实现的功能如下：

- 实现了烟花例子系统，能够生成两种类型的烟花
- 实现了加载天空盒背景
- 增加了地面，使用Bling-Pong实现了地面光照
- 实现泛光效果
- 添加了烟花爆炸音效

## 文件结构

- `\release`存放可执行结果
- `\resources`存放了顶点着色器，片段着色器动态编译文件，天空盒、地面和粒子的纹理贴图以及烟花爆炸的音效
- `Firwork`存放源代码

## 如何实现

本项目主要分为三大模块：粒子系统，光照以及天空盒。

- 粒子系统

  粒子系统由两个类组成，一个是烟花类，一个是粒子类，其中烟花类继承粒子类。

  - 烟花类

    烟花类主要维护位置、大小颜色、速度、发射角度、已发射时间和烟花生命周期等变量。烟花的爆炸过程分为4个阶段：第一阶段是上升阶段，根据速度来改变物体的位置，同时更新发射时间来判断烟花是否应该爆炸；第二阶段是爆照阶段，当烟花爆照时，在中心生成一个点光源，同时生成若干粒子；第三阶段是结束阶段，删除点光源。

  - 粒子类

    粒子和烟花的属性基本一致，两者的区别在于当烟花爆炸时才会绘制渲染粒子，分开两个类便于管理。

- 光照

  光照主要实现2个方面，一个是Bling-Pong光照模型，一个是泛光效果。

  - Bling-Pong光照

    在渲染每一个粒子或者地面的顶点时，遍历当前在空中爆炸的所有的光源，分别计算每一光源在该顶点的环境光，漫反射光和镜面发射光，最后再乘衰减系数，将所有的光源对其的影响求和得到该顶点最终的光照。

  - 泛光效果

    泛光效果本质上是提取出一个颜色物体高于某一个阈值的颜色，然后将其进行高斯模糊。在实现时，在片段着色器中分别输出片段颜色和亮色，分别存储在两个缓冲帧中，然后对储存着亮色的缓冲进行二次处理，传入模糊着色器进行高斯模糊，最后再将物体原本的颜色和模糊之后的颜色合并在一起从而实现泛光的效果。

- 天空盒

  天空盒的实现原理是将6个纹理贴图贴在一个立方体的6个面，将摄像机设置在立方体内部，同时我们在实现时，移除了观察矩阵中的位移部分，让移动不会影响天空盒的位置向量，这样就能保证天空盒背景不会移动，保持距离感和真实感。

- 音效

  使用Windows自带的用于播放声音的API函数PlaySound来实现，当烟花爆照时，调用该函数播放爆炸的声音。

## 效果展示

<img src=".\demo\img1.png" alt="image-20231208165143128" style="zoom:50%;" />

<img src=".\demo\img2.png" alt="image-20231208165252965" style="zoom:50%;" />
